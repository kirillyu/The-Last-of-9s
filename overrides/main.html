{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script>
    // Ensure language selector links always navigate (base-path safe).
    // Registered early (in <head>) so it can win against later event handlers.
    (() => {
      window.addEventListener(
        "click",
        (e) => {
          const target = e.target;
          if (!(target instanceof Element)) return;
          const link = target.closest("a.md-select__link");
          if (!link) return;
          const href = link.getAttribute("href");
          if (!href || href.startsWith("javascript:")) return;
          e.preventDefault();
          e.stopImmediatePropagation();
          window.location.href = link.href;
        },
        true
      );
    })();
  </script>
  <script>
    // TL9: add static social icons to header (GitHub / LinkedIn / Telegram).
    // URLs are taken from the About page "Contacts" section.
    (() => {
      const SOCIAL = [
        { name: "GitHub", href: "https://github.com/kirillyu", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8Z"/></svg>' },
        { name: "LinkedIn", href: "https://www.linkedin.com/in/kirillyu/", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M19 3A2 2 0 0 1 21 5v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14Zm-11.75 7H5.5v9h1.75v-9ZM6.38 7.25A1.13 1.13 0 0 0 7.5 6.12 1.12 1.12 0 0 0 6.38 5 1.12 1.12 0 0 0 5.25 6.12c0 .62.5 1.13 1.13 1.13ZM19 13.75c0-2.02-1.08-3.25-2.82-3.25-1.25 0-1.97.69-2.32 1.18V10H12.1v9h1.75v-4.72c0-1.24.63-1.99 1.7-1.99 1.05 0 1.45.74 1.45 1.99V19H19v-5.25Z"/></svg>' },
        { name: "Telegram", href: "https://t.me/r9yo11yp9e", svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M9.04 15.55 8.9 19.2c.55 0 .8-.24 1.1-.53l2.64-2.52 5.47 4c1 .55 1.72.26 1.98-.93l3.6-16.9c.35-1.64-.6-2.28-1.64-1.9L1.9 9.3c-1.58.62-1.56 1.5-.28 1.9l5.46 1.7 12.67-7.98c.6-.36 1.15-.16.7.2L9.04 15.55Z"/></svg>' },
      ];

      const ensure = () => {
        const header = document.querySelector(".md-header__inner");
        if (!header) return false;
        if (header.querySelector(".tl9-header-social")) return true;

        const wrap = document.createElement("div");
        wrap.className = "md-header__option tl9-header-social";
        wrap.setAttribute("aria-label", "Social links");

        for (const item of SOCIAL) {
          const a = document.createElement("a");
          a.className = "md-header__button tl9-social-btn";
          a.href = item.href;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.setAttribute("aria-label", item.name);
          a.title = item.name;
          a.innerHTML = item.svg;
          wrap.appendChild(a);
        }

        // Insert before search icon if possible.
        const searchLabel = header.querySelector('label[for="__search"]');
        if (searchLabel && searchLabel.parentElement) {
          searchLabel.parentElement.insertBefore(wrap, searchLabel);
        } else {
          header.appendChild(wrap);
        }
        return true;
      };

      const run = () => {
        if (ensure()) return;
        // Retry a few times: Material builds header async on some pages.
        let tries = 0;
        const t = setInterval(() => {
          tries += 1;
          if (ensure() || tries > 20) clearInterval(t);
        }, 100);
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", run, { once: true });
      } else {
        run();
      }
    })();
  </script>
  {% if page and page.meta and page.meta.robots %}
    <meta name="robots" content="{{ page.meta.robots }}">
  {% endif %}
  {% set og_title = page.meta.title if page and page.meta and page.meta.title else page.title if page and page.title else config.site_name %}
  {% set og_desc = page.meta.description if page and page.meta and page.meta.description else config.site_description %}
  {% set og_url = page.canonical_url if page and page.canonical_url else config.site_url %}
  {% set og_image = page.meta.image if page and page.meta and page.meta.image else "assets/logo-optimized.png" %}
  {% if og_image and "://" not in og_image %}
    {% set og_image = config.site_url ~ og_image %}
  {% endif %}
  {% if og_title %}
    <meta property="og:title" content="{{ og_title }}">
    <meta name="twitter:title" content="{{ og_title }}">
  {% endif %}
  {% if og_desc %}
    <meta property="og:description" content="{{ og_desc }}">
    <meta name="twitter:description" content="{{ og_desc }}">
  {% endif %}
  {% if og_url %}
    <meta property="og:url" content="{{ og_url }}">
  {% endif %}
  <meta property="og:site_name" content="{{ config.site_name }}">
  <meta property="og:type" content="{{ 'article' if page and page.meta and page.meta.date else 'website' }}">
  {% if og_image %}
    <meta property="og:image" content="{{ og_image }}">
    <meta name="twitter:image" content="{{ og_image }}">
  {% endif %}
  <meta name="twitter:card" content="summary">
{% endblock %}
