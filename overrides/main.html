{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script>
    // Ensure language selector links always navigate (base-path safe).
    // Registered early (in <head>) so it can win against later event handlers.
    (() => {
      window.addEventListener(
        "click",
        (e) => {
          const target = e.target;
          if (!(target instanceof Element)) return;
          const link = target.closest("a.md-select__link");
          if (!link) return;
          const href = link.getAttribute("href");
          if (!href || href.startsWith("javascript:")) return;
          e.preventDefault();
          e.stopImmediatePropagation();
          window.location.href = link.href;
        },
        true
      );
    })();
  </script>
  {% if page and page.meta and page.meta.robots %}
    <meta name="robots" content="{{ page.meta.robots }}">
  {% endif %}
  {% set og_title = page.meta.title if page and page.meta and page.meta.title else page.title if page and page.title else config.site_name %}
  {% set og_desc = page.meta.description if page and page.meta and page.meta.description else config.site_description %}
  {% set og_url = page.canonical_url if page and page.canonical_url else config.site_url %}
  {% set og_image = page.meta.image if page and page.meta and page.meta.image else "assets/logo-optimized.png" %}
  {% if og_image and "://" not in og_image %}
    {% set og_image = config.site_url ~ og_image %}
  {% endif %}
  {% if og_title %}
    <meta property="og:title" content="{{ og_title }}">
    <meta name="twitter:title" content="{{ og_title }}">
  {% endif %}
  {% if og_desc %}
    <meta property="og:description" content="{{ og_desc }}">
    <meta name="twitter:description" content="{{ og_desc }}">
  {% endif %}
  {% if og_url %}
    <meta property="og:url" content="{{ og_url }}">
  {% endif %}
  <meta property="og:site_name" content="{{ config.site_name }}">
  <meta property="og:type" content="{{ 'article' if page and page.meta and page.meta.date else 'website' }}">
  {% if og_image %}
    <meta property="og:image" content="{{ og_image }}">
    <meta name="twitter:image" content="{{ og_image }}">
  {% endif %}
  <meta name="twitter:card" content="summary">
{% endblock %}
